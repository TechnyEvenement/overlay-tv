<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Overlay Sport Live</title>

<style>
/* ===== STYLE BROADCAST TV ===== */
body {
  margin: 0;
  background: transparent;
  font-family: Arial, Helvetica, sans-serif;
}

#overlay {
  position: fixed;
  bottom: 40px;
  left: 40px;
  background: #ffd200;
  color: #000;
  padding: 14px 18px;
  border-radius: 6px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.4);
  min-width: 260px;
}

.line {
  display: flex;
  justify-content: space-between;
  font-weight: bold;
  font-size: 20px;
  line-height: 1.4;
}

.label {
  opacity: 0.85;
}

.value {
  font-size: 26px;
}
</style>
</head>

<body>

<div id="overlay">
  <div class="line">
    <span class="label">KM RESTANTS</span>
    <span class="value" id="km">--.-</span>
  </div>
  <div class="line">
    <span class="label">VITESSE</span>
    <span class="value" id="speed">--.-</span>
  </div>
</div>

<script>
// ===== PARAM√àTRES =====
const DISTANCE_TOTALE_KM = 25.1; // üëâ distance Komoot
let distanceParcourue = 0;
let lastPosition = null;

// ===== CALCUL DISTANCE GPS =====
function toRad(v) { return v * Math.PI / 180; }

function haversine(p1, p2) {
  const R = 6371;
  const dLat = toRad(p2.lat - p1.lat);
  const dLon = toRad(p2.lon - p1.lon);
  const a =
    Math.sin(dLat/2) * Math.sin(dLat/2) +
    Math.cos(toRad(p1.lat)) * Math.cos(toRad(p2.lat)) *
    Math.sin(dLon/2) * Math.sin(dLon/2);
  return R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)));
}

// ===== GPS LIVE =====
navigator.geolocation.watchPosition(pos => {
  const lat = pos.coords.latitude;
  const lon = pos.coords.longitude;

  // vitesse r√©elle GPS
  const speed = (pos.coords.speed || 0) * 3.6;
  document.getElementById("speed").textContent = speed.toFixed(1) + " km/h";

  if (lastPosition) {
    distanceParcourue += haversine(
      lastPosition,
      { lat, lon }
    );
  }

  lastPosition = { lat, lon };

  const kmRestants = Math.max(0, DISTANCE_TOTALE_KM - distanceParcourue);
  document.getElementById("km").textContent = kmRestants.toFixed(1);

}, {
  enableHighAccuracy: true,
  maximumAge: 1000
});
</script>

</body>
</html>
